<ion-header>
  <ion-toolbar color="primary">
    <ion-title>ğŸ‰ RevelaciÃ³n de GÃ©nero ğŸ‰</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="main-content">
  <div class="container">
    
    <!-- Header con iconos de bebÃ© -->
    <div class="header-section">
      <div class="baby-icons">
        <span class="baby-icon blue">ğŸ‘¶ğŸ»</span>
        <span class="question-icon">â“</span>
        <span class="baby-icon pink">ğŸ‘¶ğŸ»</span>
      </div>
      <h1 class="main-title">Â¿NiÃ±o o NiÃ±a?</h1>
      <p class="subtitle">Â¡DescÃºbrelo muy pronto!</p>
    </div>

    <!-- SecciÃ³n de votaciÃ³n -->
    <div class="voting-section" *ngIf="isComponentReady && votingEnabled && !deviceHasVoted">
      <ion-card class="voting-card">
        <ion-card-content>
          <h3>ğŸ—³ï¸ Â¡Haz tu predicciÃ³n!</h3>
          <p>Ãšnete a la votaciÃ³n y elige tu equipo</p>
          <ion-button 
            expand="block" 
            color="secondary" 
            routerLink="/voting"
            class="voting-btn">
            <ion-icon name="people" slot="start"></ion-icon>
            Ir a Votar
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Mensaje cuando el dispositivo ya votÃ³ -->
    <div class="device-voted-section" *ngIf="isComponentReady && deviceHasVoted">
      <ion-card class="voted-card">
        <ion-card-content>
          <h3>âœ… Â¡Ya votaste!</h3>
          <p>Este dispositivo ya registrÃ³ su voto</p>
          <ion-button 
            expand="block" 
            color="tertiary" 
            routerLink="/voting"
            class="view-results-btn">
            <ion-icon name="bar-chart" slot="start"></ion-icon>
            Ver Resultados
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Contador regresivo -->
    <div class="countdown-section" *ngIf="countdown$ | async as countdown">
      <ng-container *ngIf="isComponentReady && !countdown.isEventPassed; else eventPassed">
        <h2 class="countdown-title">Tiempo restante:</h2>
        
        <div class="countdown-grid">
          <div class="time-unit">
            <div class="time-number">{{ countdown.days }}</div>
            <div class="time-label">DÃ­as</div>
          </div>
          
          <div class="time-separator">:</div>
          
          <div class="time-unit">
            <div class="time-number">{{ countdown.hours }}</div>
            <div class="time-label">Horas</div>
          </div>
          
          <div class="time-separator">:</div>
          
          <div class="time-unit">
            <div class="time-number">{{ countdown.minutes }}</div>
            <div class="time-label">Minutos</div>
          </div>
          
          <div class="time-separator">:</div>
          
          <div class="time-unit">
            <div class="time-number">{{ countdown.seconds }}</div>
            <div class="time-label">Segundos</div>
          </div>
        </div>
      </ng-container>

      <ng-template #eventPassed>
        <!-- Loading state mientras se prepara la revelaciÃ³n -->
        <div class="reveal-loading" *ngIf="isComponentReady && !revealDataReady">
          <div class="loading-animation">
            <ion-spinner name="crescent" color="light"></ion-spinner>
          </div>
          <h2 class="loading-title">Â¡Preparando la revelaciÃ³n!</h2>
          <p class="loading-subtitle">Un momento por favor...</p>
        </div>

        <div class="direct-reveal-section" *ngIf="isComponentReady && revealDataReady && genderMessage">
          <div class="confetti-container">
            <div class="confetti" *ngFor="let confetti of confettiArray"></div>
          </div>
          
          <div class="gender-reveal-home" [ngClass]="genderClass">
            <div class="gender-icon-home">{{ genderEmoji }}</div>
            <h1 class="gender-title-home">{{ genderMessage }}</h1>
            <p class="gender-subtitle-home">{{ genderSubtitle }}</p>
          </div>

          <!-- Resultados de votaciÃ³n -->
          <div class="voting-results-section" *ngIf="isComponentReady && revealDataReady && genderMessage && votingStats && votingStats.totalVotes > 0">
            <ion-card class="results-card">
              <ion-card-content>
                <h3>ğŸ“Š Resultados de la votaciÃ³n</h3>
                <div class="results-grid">
                  <div class="result-item">
                    <div class="result-header">
                      <span class="result-emoji">ğŸ‘¦ğŸ»</span>
                      <span class="result-label">Team NiÃ±o</span>
                    </div>
                    <div class="result-bar boy-bar" [style.width]="votingStats.boyPercentage + '%'">
                      <span class="result-percentage">{{ votingStats.boyPercentage.toFixed(1) }}%</span>
                    </div>
                    <span class="result-votes">{{ votingStats.boyVotes }} votos</span>
                  </div>
                  
                  <div class="result-item">
                    <div class="result-header">
                      <span class="result-emoji">ğŸ‘§ğŸ»</span>
                      <span class="result-label">Team NiÃ±a</span>
                    </div>
                    <div class="result-bar girl-bar" [style.width]="votingStats.girlPercentage + '%'">
                      <span class="result-percentage">{{ votingStats.girlPercentage.toFixed(1) }}%</span>
                    </div>
                    <span class="result-votes">{{ votingStats.girlVotes }} votos</span>
                  </div>
                </div>
                <p class="total-votes-text">Total de predicciones: {{ votingStats.totalVotes }}</p>
                
                <!-- Mensaje especial segÃºn resultado -->
                <div class="prediction-result" [ngClass]="currentGender === 'niÃ±o' ? 'boy-won' : 'girl-won'" *ngIf="votingStats.totalVotes > 0">
                  <p *ngIf="(currentGender === 'niÃ±o' && votingStats.boyPercentage > votingStats.girlPercentage) || 
                           (currentGender === 'niÃ±a' && votingStats.girlPercentage > votingStats.boyPercentage)">
                    ğŸ¯ <strong>Â¡La mayorÃ­a acertÃ³!</strong> Team {{ currentGender === 'niÃ±o' ? 'NiÃ±o' : 'NiÃ±a' }} tenÃ­a razÃ³n.
                  </p>
                  <p *ngIf="(currentGender === 'niÃ±o' && votingStats.boyPercentage < votingStats.girlPercentage) || 
                           (currentGender === 'niÃ±a' && votingStats.girlPercentage < votingStats.boyPercentage)">
                    ğŸ˜® <strong>Â¡Sorpresa!</strong> Team {{ currentGender === 'niÃ±o' ? 'NiÃ±a' : 'NiÃ±o' }} tenÃ­a la predicciÃ³n mayoritaria, pero...
                  </p>
                  <p *ngIf="votingStats.boyPercentage === votingStats.girlPercentage">
                    ğŸ¤ <strong>Â¡Empate perfecto!</strong> Estaba dividida la opiniÃ³n.
                  </p>
                </div>
              </ion-card-content>
            </ion-card>
          </div>

          <div class="celebration-buttons-home" *ngIf="isComponentReady && revealDataReady && genderMessage">
            <ion-button 
              expand="block" 
              size="large" 
              [color]="genderColor"
              (click)="shareNews()">
              <ion-icon name="share" slot="start"></ion-icon>
              Â¡Compartir la Noticia!
            </ion-button>
          </div>
        </div>
      </ng-template>
    </div>

    <!-- InformaciÃ³n de la fecha -->
    <div class="date-info" *ngIf="isComponentReady">
      <ion-card>
        <ion-card-content>
          <h3>
            <span>ğŸ“…</span>
            <span>Fecha de RevelaciÃ³n</span>
          </h3>
          <div class="reveal-date" *ngIf="revealDate; else loadingDate">
            {{ formatDate(revealDate) }}
          </div>
          <ng-template #loadingDate>
            <div class="reveal-date loading-date">
              <ion-spinner name="dots" color="primary"></ion-spinner>
              <span>Cargando fecha...</span>
            </div>
          </ng-template>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Mensaje de integridad y seguridad -->
    <div class="integrity-warning" *ngIf="isComponentReady && !timeIntegrityVerified">
      <ion-chip color="warning">
        <ion-icon name="warning"></ion-icon>
        <ion-label>ğŸ” Sistema protegido contra manipulaciÃ³n de fecha/hora</ion-label>
      </ion-chip>
    </div>
    
    <!-- InformaciÃ³n de seguridad -->
    <div class="security-info" *ngIf="isComponentReady">
      <ion-chip color="success" fill="outline">
        <ion-icon name="shield-checkmark"></ion-icon>
        <ion-label>Hora sincronizada con servidor</ion-label>
      </ion-chip>
    </div>

    <!-- Copyright -->
    <div class="copyright-section" *ngIf="isComponentReady">
      <p class="copyright-text">
        Â© 2025 Desarrollado por 
        <a href="https://instagram.com/chana.fp" target="_blank" class="developer-link">
          Francisco Paredes
        </a>
      </p>
    </div>

  </div>
</ion-content>
