<ion-header>
  <ion-toolbar color="secondary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>游꿁 춰Momento de la Revelaci칩n! 游꿁</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="reveal-content">
  <div class="reveal-container">
    
    <!-- Calendario de cuenta regresiva -->
    <div class="calendar-countdown" *ngIf="!revealed">
      <div class="calendar-header">
        <h2>游늰 Calendario de la Revelaci칩n</h2>
        <p class="calendar-subtitle">Cada d칤a nos acercamos m치s al gran momento</p>
      </div>
      
      <div class="countdown-display">
        <div class="countdown-card" *ngIf="countdown$ | async as countdown">
          <div class="time-remaining">
            <h3>Tiempo restante:</h3>
            <div class="countdown-numbers">
              <div class="countdown-item">
                <span class="number">{{ countdown.days }}</span>
                <span class="label">D칤as</span>
              </div>
              <div class="countdown-item">
                <span class="number">{{ countdown.hours }}</span>
                <span class="label">Horas</span>
              </div>
              <div class="countdown-item">
                <span class="number">{{ countdown.minutes }}</span>
                <span class="label">Min</span>
              </div>
              <div class="countdown-item">
                <span class="number">{{ countdown.seconds }}</span>
                <span class="label">Seg</span>
              </div>
            </div>
          </div>
          
          <div class="progress-section">
            <div class="progress-bar">
              <div class="progress-fill" [style.width]="getProgressPercentage() + '%'"></div>
            </div>
            <p class="progress-text">{{ getProgressPercentage().toFixed(1) }}% del tiempo transcurrido</p>
          </div>
        </div>
      </div>
      
      <div class="calendar-decoration">
        <div class="calendar-icons">
          <span class="calendar-day" *ngFor="let day of calendarDays" 
                [class.completed]="day.completed"
                [class.today]="day.isToday">
            {{ day.number }}
          </span>
        </div>
      </div>
    </div>

    <!-- Resultado de la revelaci칩n -->
    <div class="reveal-result" *ngIf="revealed">
      <div class="confetti-container">
        <div class="confetti" *ngFor="let confetti of confettiArray"></div>
      </div>
      
      <div class="gender-reveal" [ngClass]="genderClass">
        <div class="gender-icon">{{ genderEmoji }}</div>
        <h1 class="gender-title">{{ genderMessage }}</h1>
        <p class="gender-subtitle">{{ genderSubtitle }}</p>
      </div>

      <!-- Resultados de votaci칩n -->
      <div class="voting-results-section" *ngIf="votingStats && votingStats.totalVotes > 0">
        <ion-card class="results-card">
          <ion-card-content>
            <h3>游늵 Resultados de la votaci칩n</h3>
            <div class="results-grid">
              <div class="result-item">
                <div class="result-header">
                  <span class="result-emoji">游녽游낕</span>
                  <span class="result-label">Team Ni침o</span>
                </div>
                <div class="result-bar boy-bar" [style.width]="votingStats.boyPercentage + '%'">
                  <span class="result-percentage">{{ votingStats.boyPercentage.toFixed(1) }}%</span>
                </div>
                <span class="result-votes">{{ votingStats.boyVotes }} votos</span>
              </div>
              
              <div class="result-item">
                <div class="result-header">
                  <span class="result-emoji">游녾游낕</span>
                  <span class="result-label">Team Ni침a</span>
                </div>
                <div class="result-bar girl-bar" [style.width]="votingStats.girlPercentage + '%'">
                  <span class="result-percentage">{{ votingStats.girlPercentage.toFixed(1) }}%</span>
                </div>
                <span class="result-votes">{{ votingStats.girlVotes }} votos</span>
              </div>
            </div>
            <p class="total-votes-text">Total de predicciones: {{ votingStats.totalVotes }}</p>
            
            <!-- Mensaje especial seg칰n resultado -->
            <div class="prediction-result" [ngClass]="GENDER === 'ni침o' ? 'boy-won' : 'girl-won'" *ngIf="votingStats.totalVotes > 0">
              <p *ngIf="(GENDER === 'ni침o' && votingStats.boyPercentage > votingStats.girlPercentage) || 
                       (GENDER === 'ni침a' && votingStats.girlPercentage > votingStats.boyPercentage)">
                游꿢 <strong>춰La mayor칤a acert칩!</strong> Team {{ GENDER === 'ni침o' ? 'Ni침o' : 'Ni침a' }} ten칤a raz칩n.
              </p>
              <p *ngIf="(GENDER === 'ni침o' && votingStats.boyPercentage < votingStats.girlPercentage) || 
                       (GENDER === 'ni침a' && votingStats.girlPercentage < votingStats.boyPercentage)">
                游땵 <strong>춰Sorpresa!</strong> Team {{ GENDER === 'ni침o' ? 'Ni침a' : 'Ni침o' }} ten칤a la predicci칩n mayoritaria, pero...
              </p>
              <p *ngIf="votingStats.boyPercentage === votingStats.girlPercentage">
                游뱋 <strong>춰Empate perfecto!</strong> Estaba dividida la opini칩n.
              </p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>

      <div class="celebration-buttons">
        <ion-button 
          expand="block" 
          size="large" 
          [color]="genderColor"
          (click)="shareNews()">
          <ion-icon name="share" slot="start"></ion-icon>
          춰Compartir la Noticia!
        </ion-button>
        
        <ion-button 
          expand="block" 
          fill="outline" 
          [color]="genderColor"
          routerLink="/home">
          <ion-icon name="home" slot="start"></ion-icon>
          Volver al Inicio
        </ion-button>
      </div>
    </div>

  </div>
</ion-content>
