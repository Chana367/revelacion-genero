<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>ğŸ—³ï¸ VotaciÃ³n Team BebÃ©</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="voting-content">
  <div class="voting-container">
    
    <!-- Header de votaciÃ³n -->
    <div class="voting-header">
      <h1>Â¿QuÃ© crees que serÃ¡?</h1>
      <p>Â¡Ãšnete a la predicciÃ³n y vota por tu equipo!</p>
      <div class="custom-message">
        <div class="family-story">
          <div class="parents-icons">
            <span class="parent-icon mom">ğŸ‘©ğŸ»â€â¤ï¸â€ğŸ‘¨ğŸ»</span>
            <span class="heart-beat">ğŸ’•</span>
          </div>
          <p class="family-message">
            <span class="highlight-text">Pronto sabremos si</span>
            <br>
            <span class="parents-names">Gaby y Vicky</span>
            <span class="highlight-text">tendrÃ¡n</span>
            <br>
            <span class="choice-container">
              <span class="choice-option boy-choice">
                <span class="choice-emoji">ğŸš—</span>
                <span class="choice-text">carritos</span>
              </span>
              <span class="or-text">o</span>
              <span class="choice-option girl-choice">
                <span class="choice-emoji">ğŸ€</span>
                <span class="choice-text">muÃ±ecas</span>
              </span>
            </span>
            <span class="highlight-text">en casa</span>
            <span class="home-emoji">ğŸ âœ¨</span>
          </p>
          <div class="love-decoration">
            <span class="float-heart">ğŸ’–</span>
            <span class="float-heart">ğŸŒŸ</span>
            <span class="float-heart">ğŸ‘¶ğŸ»</span>
            <span class="float-heart">ğŸ’•</span>
          </div>
        </div>
      </div>
    </div>

    <!-- EstadÃ­sticas actuales -->
    <div class="stats-section" *ngIf="stats$ | async as stats">
      <ion-card class="stats-card">
        <ion-card-content>
          <h2>Resultados hasta ahora</h2>
          <div class="stats-grid">
            <div class="stat-item boy-stat" [class.high-percentage]="stats.boyPercentage > 80">
              <div class="stat-content">
                <span class="stat-emoji">ğŸ‘¦ğŸ»</span>
                <span class="stat-label">Team NiÃ±o</span>
                <span class="stat-number">{{stats.boyVotes}}</span>
                <span class="stat-percentage">{{stats.boyPercentage.toFixed(1)}}%</span>
              </div>
              <div class="progress-bar" [style.width]="stats.boyPercentage + '%'"></div>
            </div>
            <div class="stat-item girl-stat" [class.high-percentage]="stats.girlPercentage > 80">
              <div class="stat-content">
                <span class="stat-emoji">ğŸ‘§ğŸ»</span>
                <span class="stat-label">Team NiÃ±a</span>
                <span class="stat-number">{{stats.girlVotes}}</span>
                <span class="stat-percentage">{{stats.girlPercentage.toFixed(1)}}%</span>
              </div>
              <div class="progress-bar" [style.width]="stats.girlPercentage + '%'"></div>
            </div>
          </div>
          <p class="total-votes">Total de votos: {{stats.totalVotes}}</p>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Formulario de votaciÃ³n -->
    <div class="voting-form" *ngIf="!hasVoted && !deviceHasVoted">
      
      <!-- Mensaje cuando la votaciÃ³n estÃ¡ cerrada -->
      <ion-card color="warning" *ngIf="!votingEnabled">
        <ion-card-content class="voting-closed-content">
          <ion-icon name="time" class="warning-icon"></ion-icon>
          <h2>VotaciÃ³n Cerrada</h2>
          <p>La votaciÃ³n se ha cerrado porque queda menos de 1 minuto para la revelaciÃ³n.</p>
          <p><strong>Â¡La revelaciÃ³n estÃ¡ por comenzar!</strong></p>
        </ion-card-content>
      </ion-card>

      <!-- Formulario de votaciÃ³n (solo si estÃ¡ habilitada) -->
      <ion-card *ngIf="votingEnabled">
        <ion-card-header>
          <ion-card-title>Â¡Haz tu predicciÃ³n!</ion-card-title>
          <ion-card-subtitle *ngIf="minutesRemaining > 1">
            Tiempo restante para votar: {{ minutesRemaining.toFixed(0) }} minutos
          </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          
          <!-- Input para nombre -->
          <ion-item class="name-input-item">
            <ion-label position="stacked" color="primary">
              <strong>Tu nombre</strong>
            </ion-label>
            <ion-input 
              type="text" 
              [(ngModel)]="voterName" 
              placeholder="Escribe tu nombre aquÃ­"
              maxlength="30"
              fill="outline"
              class="name-input">
            </ion-input>
          </ion-item>

          <!-- Botones de selecciÃ³n de gÃ©nero -->
          <div class="prediction-buttons">
            <ion-button 
              expand="block" 
              fill="outline"
              [color]="selectedPrediction === 'niÃ±o' ? 'primary' : 'medium'"
              [fill]="selectedPrediction === 'niÃ±o' ? 'solid' : 'outline'"
              (click)="selectPrediction('niÃ±o')"
              class="prediction-btn">
              <ion-icon name="male" slot="start"></ion-icon>
              ğŸ‘¦ğŸ» Team NiÃ±o
              <ion-icon name="checkmark" slot="end" *ngIf="selectedPrediction === 'niÃ±o'"></ion-icon>
            </ion-button>

            <ion-button 
              expand="block" 
              fill="outline"
              [color]="selectedPrediction === 'niÃ±a' ? 'tertiary' : 'medium'"
              [fill]="selectedPrediction === 'niÃ±a' ? 'solid' : 'outline'"
              (click)="selectPrediction('niÃ±a')"
              class="prediction-btn">
              <ion-icon name="female" slot="start"></ion-icon>
              ğŸ‘§ğŸ» Team NiÃ±a
              <ion-icon name="checkmark" slot="end" *ngIf="selectedPrediction === 'niÃ±a'"></ion-icon>
            </ion-button>
          </div>

          <!-- BotÃ³n de envÃ­o -->
          <ion-button 
            expand="block" 
            size="large" 
            color="success"
            (click)="submitVote()"
            [disabled]="!voterName.trim() || !selectedPrediction || isSubmitting || !votingEnabled || deviceHasVoted"
            class="submit-btn">
            <ion-icon name="send" slot="start" *ngIf="!isSubmitting"></ion-icon>
            <ion-spinner name="crescent" slot="start" *ngIf="isSubmitting"></ion-spinner>
            {{ isSubmitting ? 'Enviando...' : 'Â¡Enviar mi voto!' }}
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Mensaje cuando el dispositivo ya votÃ³ -->
    <div class="device-voted-section" *ngIf="deviceHasVoted && !hasVoted">
      <ion-card color="tertiary">
        <ion-card-content class="device-voted-content">
          <ion-icon name="checkmark-done" class="success-icon"></ion-icon>
          <h2>Â¡Ya votaste desde este dispositivo!</h2>
          <p>Este dispositivo ya registrÃ³ un voto anteriormente.</p>
          <p><em>Solo se permite un voto por dispositivo para mantener la votaciÃ³n justa.</em></p>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Mensaje de agradecimiento -->
    <div class="thank-you-section" *ngIf="showThankYou">
      <ion-card color="success">
        <ion-card-content class="thank-you-content">
          <ion-icon name="checkmark-circle" class="success-icon"></ion-icon>
          <h2>Â¡Gracias por votar!</h2>
          <p>Tu predicciÃ³n ha sido registrada exitosamente</p>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Votos recientes -->
    <div class="recent-votes" *ngIf="recentVotes.length > 0">
      <h3>Predicciones recientes</h3>
      <div class="votes-list">
        <div class="vote-item" *ngFor="let vote of recentVotes">
          <div class="vote-info">
            <span class="vote-emoji">{{ getVoteIcon(vote.prediction) }}</span>
            <span class="voter-name">{{ vote.voterName }}</span>
            <span class="vote-prediction">Team {{ vote.prediction === 'niÃ±o' ? 'NiÃ±o' : 'NiÃ±a' }}</span>
          </div>
          <span class="vote-time">{{ getRelativeTime(vote.timestamp) }}</span>
        </div>
      </div>
    </div>

    <!-- Copyright -->
    <div class="copyright-section">
      <p class="copyright-text">
        Â© 2025 Desarrollado por 
        <a href="https://instagram.com/chana.fp" target="_blank" class="developer-link">
          Francisco Paredes
        </a>
      </p>
    </div>

  </div>
</ion-content>